<%= notice %>
<div class="container">
	<div class="row">
		<div class="col-xs-3">
			<div class="row">
				<h2>User info</h2>
				<div>
				    <%= attachment_image_tag @book.user, :profile_image, :fill, 80, 80, format: 'jpeg', fallback: "no_image.jpg" %>
				</div>
				<table class="table table-striped">
				<tbody>
					<tr>
						<th>name</th>
						<th><%= @book.user.name %></th>
					</tr>
					<tr>
						<th>introduction</th>
						<th><%= @book.user.introduction %></th>
					</tr>
				</tbody>
				</table>
					<% if @book.user == current_user  %>
			        <p>
			        	<%= link_to edit_user_path(current_user.id) do %>
			        	<button type="button" class="btn btn-default" aria-label="Center Align"><span class="glyphicon glyphicon-cog" aria-hidden="true"></span>編集</button>

			        	<% end %>
			        </p>

			       	 <% else %>
			       	<p>
			        	<%= link_to user_path(current_user.id) do %>
			        	<button type="button" class="btn btn-default" aria-label="Center Align"><span class="glyphicon glyphicon-cog" aria-hidden="true"></span>編集</button>

			        	<% end %>
			        </p>
			    	<% end %>
		    </div>

            <h3><span>New Book</span></h3>

	              <%= form_for(@book, url: books_path) do |f| %>
		                <% if @book.errors.any? %>
		                  <div id="error_explanation">
		                    <h3><%= pluralize(book.errors.count, "error") %> invalidated your post.</h3>
		                    <ul>
		                    <% @book.errors.full_messages.each do |message| %>
		                      <li><%= message %></li>
		                    <% end %>
		                    </ul>
		                  </div>
		                <% end %>
		                <div class="row">
		                  <div class="col-md-12">
		                    <div class="form-group has-icon">
		                    <h5>Title</h5>
		                      <%= f.text_field :title, size: "36", class: "book_title" %>
		                    </div>
		                  </div>
		                </div>
		                <div class="row">
		                  <div class="col-md-12">
		                  	<h5>Opinion</h5>
		                    <%= f.text_area :body, size: "35x2", class: "book_body" %>
		                  </div>
		                </div>
		                <div class="row">
		                  <div class="col-md-12">
		                    <%= f.submit "create Book", class: "btn btn-lg btn-primary btn-base-1 mt-20" %>
		                  </div>
		                </div>
	              <% end %>
        </div>


        <div class="col-xs-9">

				<h2>Book detail</h2>
				<table class="table">
					<tbody>
						<tr>
							<td><%= link_to user_path(@book.user.id), class: "user_#{@book.user.id}" do %>
								<%= attachment_image_tag @book.user, :profile_image, :size => "40x40", format: 'jpeg', fallback: "no_image.jpg" %>
								<br>
								<p><%= @book.user.name %></p>
                    			<% end %>
							</td>

							<td>
								<%= link_to book_path(@book.id), class: "book_#{@book.id}" do %>
								<%= @book.title %>
								<% end %>
							</td>

							<td><%= @book.body %></td>

							<td>
								<% if @book.user == current_user %>
								<%= link_to "Edit", edit_book_path(@book.id), class: "edit_#{@book.id}" %>
								<% end %>
							</td>

							<td>
								<% if @book.user == current_user %>
								  <%= link_to "Destroy", book_path(@book), class: "destroy_book_#{@book.id}", method: :delete %>
								<% end %>
							</td>
							<% if @book.favorited_by?(current_user) %>
                  <th>
                    <%= link_to book_favorites_path(@book), method: :delete do %>
                      <i><span class="glyphicon glyphicon-heart" aria-hidden="true"></span></i>
                      <%= @book.favorites.count %> いいね</th>
                    <% end %>
                <% else %>
                  <th>
                    <%= link_to book_favorites_path(@book), method: :post do %>
                      <i><span class="glyphicon glyphicon-heart-empty" aria-hidden="true"></span></i>
                      <%= @book.favorites.count %> いいね
                    <% end %>
                  </th>
                <% end %>

                    <% if @book.user == current_user %>
                      <td>
                         <button type="button" class="btn btn-info"><%= link_to "edit",edit_book_path, class: "edit_book_#{@book.id}" %></button>
                      </td>
                      <td>
                       <button type="button" class="btn btn-danger"><%= link_to "Destroy",book_path,method: :delete, class: "destroy_book_#{@book.id}" %></button>
                      </td>
                      <% end %>
                <!-- ここまで -->
      </tr>
        </table>
                <!-- ここからコメント -->

                  <div class="comment-list bt style-2" id="comments">
                    <div class="float-wrapper">
                        <h3 class="comment-count"><%= @book.book_comments.count %>件コメント</h3>
                    </div>
                    <ol>
                      <% @book.book_comments.each do |book_comment| %>
                          <li class="comment">
                              <div class="comment-body bb">
                                  <div class="comment-text">
                                      <div class="comment-author clearfix">
                                          <a href="#" class="link-author"><%= book_comment.user.name %></a>
                                          <span class="comment-meta">
                                            <span class="comment-date"><%= book_comment.created_at.strftime('%Y/%m/%d') %></span>
                                          </span>
                                      </div>
                                      <div class="comment-entry"><%= book_comment.comment %></div>
                                  </div>
                              </div>
                                                <!-- コメント削除 -->
                  <% if book_comment.user == current_user %>
                   <%= link_to "削除", book_book_comments_path(book_comment), method: :delete, class: "btn btn-danger" %>
                  <% end %>
                                                  <!-- ここまで-->
                          </li>
                      <% end %>
                  </ol>

                  <%= form_for [@book, @book_comment] do |f| %>
                    <div class="row">
                        <div class="col-sm-12">
                            <%= f.text_area :comment, rows:'5', class: "form-control",placeholder: "コメントをここに" %>
                        </div>
                    </div>
                    <%= f.submit "送信する", class: "btn btn-lg btn-base-1 mt-20 pull-right" %>
                  <% end %>
                                      <% if @book_comment.user == current_user %>
                      <td>
                       <button type="button" class="btn btn-danger"><%= link_to "削除", book_book_comment_path(@book, book_comment), method: :delete, remote: true, class: "btn btn-danger" %></button>
                      </td>
                      <% end %>
						</tr>
					</tbody>
				</table>
        </div>
    </div>
</div>